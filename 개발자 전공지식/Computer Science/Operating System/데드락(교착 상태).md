# 데드락(Dead-lock, 교착 상태)

<br>

### 개념

운영체제에서 데드락이란, 시스템 자원에 대한 요구가 뒤엉킨 상태를 말한다.<br>
즉, **둘 이상의 프로세스가 다른 프로세스를 점유하고 있는 자원을 서로 기다릴 때 무한 대기에 빠지는 상황**을 일컫는다.

<p align="center">
<img src="https://user-images.githubusercontent.com/66001046/194872227-77b980b5-7054-4d75-9c82-18957d38583b.png">
</p>

간단하게 설명하자면, 위 사진처럼 자동차(프로세스)들이 각각의 도로(자원)를 점유한 상태에서 다른 자동차(프로세스)들이 사용하고 있는<br>
도로(자원)를 사용하기 위해 대기하고 있지만, 도로 위에서 이러지도 저러지도 못하는 상황을 예시로 들 수 있다.

<br>

### 발생 조건

교착 상태는 한 시스템 내에서 다음 4가지 조건이 동시에 성립할 때 발생하며, 하나라도 만족하지 않으면 발생하지 않는다.

#### 1. 상호 배제

- **한 번에 프로세스 하나만 해당 자원을 사용할 수 있다.**<br>
사용중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야 한다.

#### 2. 점유 대기

- 자원을 최소한 하나 보유하고, 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해서는 대기하는 프로세스가 있어야 한다.

#### 3. 비선점

- 다른 프로세스에 이미 할당된 자원을 강제로 빼앗을 수 없다.

#### 4. 순환 대기

- 대기 프로세스의 집합이 순환 형태로 자원을 대기하고 있어야 한다.

<br>

### 해결법

- 데드락이 발생하지 않도록 **예방(prevention)**
- 데드락 발생 가능성을 인정하면서도 적절하게 **회피(avoidance)**
- 데드락 발생을 허용하지만 데드락을 **탐지(detection)** 하여, 데드락에서 **회복(recovery)**

#### 예방(Preventrion)

**데드락 발생조건 4가지 중 하나라도 발생하지 않게 하는 것**이 데드락을 예방하는 방법이다.<br>
즉, 각각의 조건을 방지(부정)하여 데드락 발생 가능성을 차단한다.

- **자원의 상호 배제 조건 방지** : 한 번에 여러 프로세스가 공유 자원을 사용할 수 있게 한다. 그러나, 추후 동기화 관련 문제가 발생할 수 있다.
- **점유 대기 조건 방지** : 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류,<br>
나중에 또다른 자원을 점유하기 위한 대기 조건을 성립하지 않도록 한다.
- **비선점 조건 방지** : 이미 다른 프로세스에게 할당된 자원이 선점권이 없다고 가정할 때, 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있게 한다.
- **순환 대기 조건 방지** : 자원을 순환 형태로 대기하지 않도록 일정한 방향으로만 자원을 요구할 수 있도록 한다.

이 방법은 **시스템의 처리량이나 효율성을 떨어뜨리는 단점** 이 발생할 수 있다.

#### 회피(Aboidance)

시스템의 프로세스들이 요청하는 모든 자원을, 데드락을 발생시키지 않으면서도 차례로 모두에게 할당해 줄 수 있다면 **안정 상태(safe state)** 에 있다고 한다.<br>
그리고 특정한 순서로 프로세스에게 자원을 할당, 실행 및 종료 등의 작업을 할 때 **데드락이 발생하지 않는 순서를 찾을 수 있다면,** 그것을 **안전 순서(safe sequence)** 라고 한다.

반면 **불안정 상태**는 안정 상태가 아닌 상황을 말한다. 즉, **데드락 발생 가능성이 있는 상황**이며, **데드락은 불안정 상태 일때 발생할 수 있다.**

이처럼 회피 알고리즘은 **자원을 할당한 후에도 시스템이 항상 safe state에 있을 수 있도록 할당을 허용**하자는 것이 기본 특징이다.

교착 상태를 회피하기 위한 알고리즘은 **은행원 알고리즘**과 **자원 할당 그래프 알고리즘** 두 가지가 존재한다.

#### 탐지(Detection) 및 회복(Recovery)

데드락을 탐지 기법을 통해 발견했다면, **순환 대기에서 벗어나 데드락으로부터 회복하기 위한 방법**을 사용한다.

- 단순히 프로세스 1개 이상 중단시키기
	- **교착 상태에 빠진 모든 프로세스를 중단시키는 방법** :<br>
	계속 연산중이던 프로세스들도 모두 일시에 중단되어 부분 결과가 폐기될 수 있는 부작용이 발생할 수 있다.
	- **프로세스를 하나씩 중단 시킬 때마다 탐지 알고리즘으로 탐지하면서 회복시키는 방법** :<br>
	매번 탐지 알고리즘을 호출 및 수행해야 하므로 부담이 되는 작업일 수 있다.
- 자원 선점하기
	- 프로세스에 할당된 자원을 선점해서, 교착 상태를 해결할 때까지 그 자원을 다른 프로세스에게 할당해 주는 방법

<br><br><br>

---

<br><br><br>