# Servlet과 Servlet의 동작방식

<br>

## 서블릿(Servlet)
### 서블릿이란?
- Dynamic Web Page를 만들 때 사용되는 자바 기반의 웹 애플리케이션 프로그램이다.
- 서블릿을 이용하면 웹 요청과 응답을 간단한 메소드 호출만으로 다룰 수 있다.

<br>

### 서블릿의 특징
- HTML을 사용하여 Response한다.
- JAVA의 스레드를 이용하여 동작한다.
- MVC 패턴에서의 컨트롤러로 이용된다.
- UDP보다 속도가 느리다.
- HTML 변경시, Servlet을 재 컴파일해야 하는 단점이 있다.
- Servlet 코드 내에 HTML 코드가 존재한다. 즉, 비즈니스 로직과 프레젠테이션 로직이 함께 존재하여 개발 및 관리가 어렵다.

<br>

## 서블릿 컨테이너
### 서블릿 컨테이너란?
- Web container라고도 하며, servlet 객체를 생성, servlet 메소드를 호출하는 주체이다.
- 서블릿 컨테이너는 클라이언트의 요청을 받아주고 응답을 할 수 있도록 소켓을 만들어 웹서버와 통신하는 역할을 한다.
- 대표적인 예로 톰캣이 있다. 톰캣은 웹서버와 통신하여 JSP와 Servlet이 작동하는 환경을 제공한다.

<br>

### 서블릿 컨테이너의 주요 기능
**1. 생명주기 관리**
- 서블릿 컨테이너가 기동되는 순간 서블릿 클래스를 로딩해서 인스턴스화하고 초기화 메소드를 호출한다.
- 요청이 들어오면 그에 맞는 서블릿 메소드를 찾아서 동작한다.
- 서블릿이 종료되는 순간 가비지 컬렉션을 통해 메모리에서 제거한다.

**2. 통신 지원**

- 서블릿 컨테이너는 서블릿과 웹서버가 손쉽게 통신할 수 있게 해준다. 
- 소켓을 만들고 listen, accept 등을 API로 제공하여 복잡한 과정을 생략할 수 있게 해준다.

**3. 멀티스레딩 관리**

- 서블릿 컨테이너는 서블릿 요청이 들어오면 스레드를 생성하여 작업을 수행한다.
- 그렇기 때문에 동시에 여러 요청이 들어와도 멀티스레딩 환경으로 동시다발적인 작업을 관리할 수 있다.

**4. 선언적인 보안관리**

- 보안관리를 지원하기 때문에 서블릿이나 자바 클래스 안에서 보안 관련된 메소드를 구현하지 않아도 된다.

<br>

## 서블릿의 동작과정

<img src="https://user-images.githubusercontent.com/50553183/188808369-59195a91-a511-476e-9ba2-f6bd0641806f.png">

<br>


1. 클라이언트가 URL을 입력하면 HTTP Request가 Servlet Container로 전송된다.
2. web.xml 설정 파일을 참고하여 매핑할 Servlet을 확인한다.
3. 해당 서블릿 인스턴스 존재 유무를 확인하여 없으면 init() 메소드를 호출하여 생성한다. <br>
메모리에 로드된 서블릿 인스턴스는 파일이 변경되지 않는 이상 서버가 종료될 때까지 존재하기 때문에 다음 요청 시에는 해당 객체를 재활용한다.
4. 서블릿 컨테이너에 스레드를 생성하고 service를 실행한다. <br>
service() 메소드는 요청 내용을 분석해서 doGet()메소드 또는 doPost() 메소드를 실행해줍니다.
5. 톰캣의 서블릿 컨테이너가 서블릿을 종료시킬 때 호출하는 메소드입니다. <br>
서블릿을 수정하면 컨테이너가 다시 서블릿을 로드 시키는데, 이 때 기존 메모리에 올라와있던 서블릿을 종료시킵니다.<br> 
또는 서버가 정상적으로 종료될 때도 실행됩니다.


